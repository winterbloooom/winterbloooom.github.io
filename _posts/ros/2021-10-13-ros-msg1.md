---
title:  "[Tutorial] ì»¤ìŠ¤í…€ ë©”ì‹œì§€(custom msg) ë§Œë“¤ê¸° (1)"
excerpt: "ROS Tutorial 6: ì§ì ‘ ë©”ì‹œì§€í˜•(ROS msg file) ë§Œë“¤ê¸° (1)"

categories:
  - ROS
tags:
  - Robotics
  - ROS
date: 2021-10-13
last_modified_at: 2021-10-13
order: 6

use_math: true
toc: true
tock_sticky: true
toc_label: "Contents"
---

ìƒˆë¡œ ì•Œê²Œë˜ê±°ë‚˜ ë³´ì¶©í•  ë¶€ë¶„ì„ ì°¾ì•„ ê³„ì† ì—…ë°ì´íŠ¸í•  ì˜ˆì •ì…ë‹ˆë‹¤.
{: .notice--info}

<span style="color: green">**ë…¸ë“œ ê°„ì— í† í”½ì„ ì£¼ê³  ë°›ì„ ë•Œ, í† í”½ì˜ ìë£Œí˜•ì„ ë©”ì‹œì§€ë¼ê³  í•œë‹¤.**</span> ê¸°ì¡´ì— ë‚˜ì™€ ìˆê±°ë‚˜ ë‚´ì¥ë˜ì–´ ìˆëŠ” ë©”ì‹œì§€ íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ, ê²½ìš°ì— ë”°ë¼ ì›í•˜ëŠ” ë°ì´í„°ë§Œ í¼ë¸”ë¦¬ì‹œ í•œë‹¤ë˜ì§€ í˜¹ì€ ë°ì´í„°ë¥¼ ê°€ê³µí•´ ë‹¤ì‹œ í¼ë¸”ë¦¬ì‹œ í•˜ëŠ” ë“± ë˜ë‹¤ë¥¸ ë©”ì‹œì§€ íƒ€ì…ì„ ë§Œë“¤ê³  ì‹¶ì„ ë•Œê°€ ìˆë‹¤.

<span style="color: green">**ì‚¬ìš©ìê°€ ì„ì˜ë¡œ ë§Œë“¤ì–´ë‚¸ ë©”ì‹œì§€**</span>ë¥¼ <span style="background-color: #12B886; color: white">**ì»¤ìŠ¤í…€ ë©”ì‹œì§€(custom message)**</span>ë¼ê³  í•˜ë©°, ì§€ê¸ˆë¶€í„° ì»¤ìŠ¤í…€ ë©”ì‹œì§€ë¥¼ ë§Œë“¤ê³  ì‚¬ìš©í•˜ëŠ” ì˜ˆë¥¼ ì•Œì•„ë³¸ë‹¤.

ë˜í•œ ì´ì–´ì§€ëŠ” í¬ìŠ¤íŒ…ì—ì„œëŠ” GPS, IMU, LiDAR ë“±ì˜ ê¸°ê¸°ì—ì„œ ë°›ì•„ë“¤ì´ëŠ” í† í”½ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¼í…ë°, ì´ í¬ìŠ¤íŒ…ì„ í•œ ë²ˆì¯¤ ë³´ê³  ê°€ì•¼ ì´í•´ê°€ ì‰¬ìš¸ ê²ƒì´ë‹¤.


# ğŸ¤” ì»¤ìŠ¤í…€ ë©”ì‹œì§€ì˜ í•„ìš”ì„±
ìœ„ì—ì„œë„ ì„¤ëª…í•œ ë°” ìˆì§€ë§Œ, ë…¸ë“œ&í† í”½ í†µì‹  ì¤‘ì— ì»¤ìŠ¤í…€ ë©”ì‹œì§€ê°€ í•„ìš”í•  ë•Œê°€ ì¢…ì¢… ìˆë‹¤.

ROSì—ëŠ” í‘œì¤€ ë©”ì‹œì§€ íƒ€ì…ë“¤ì´ ì •ì˜ë˜ì–´ ìˆì–´, ì†ŒìŠ¤ ì½”ë“œë¥¼ ë§Œë“¤ ë•Œ ì´ë“¤ì„ import í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ê²½ìš°ì— ë”°ë¼ì„œëŠ” ë‹¤ì–‘í•œ íƒ€ì…ì˜ ìë£Œí˜•ì„ ê°€ì§€ëŠ” ê°’ë“¤ì„ ë¬¶ì–´ ë³´ë‚´ëŠ” ë“± ë§ˆìŒëŒ€ë¡œ ì¡°ì‘ì„ í•˜ê³  ì‹¶ì€ ê²½ìš°ê°€ ë§ë‹¤.

í•„ìì˜ ê²½ìš°, GUIë¥¼ ë§Œë“¤ì§€ ì•Šì•˜ì„ ë•Œ í˜„ì¬ êµ¬ë™ì¤‘ì¸ ë¡œë´‡(ë³´íŠ¸)ì˜ ì†ë„, ëª©í‘œì ê¹Œì§€ì˜ ê±°ë¦¬, ì—ëŸ¬ê° ë“±ì˜ ìƒíƒœë¥¼ ê·¸ë•Œê·¸ë•Œ í„°ë¯¸ë„ ì°½ì—ì„œ ë³´ê³  ì‹¶ì—ˆë‹¤. í•˜ì—¬ ì´ ì •ë³´ë¥¼ ë”°ë¡œ ë‹´ì„ ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ íŒŒì¼ì„ ë§Œë“¤ì–´ í•˜ë‚˜ì˜ í† í”½ìœ¼ë¡œ ì „ì†¡í•˜ê³ , `rostopic echo` ëª…ë ¹ì–´ë¥¼ í†µí•´ ëª¨ë‹ˆí„°ë§í•œ ë°”ê°€ ìˆì—ˆë‹¤.

ë˜ëŠ” ì„¼ì„œì—ì„œ ë°›ì•„ì˜¨ ê°’ì„ ì´ë¦¬ì €ë¦¬ ì¡°ì‘í•˜ì—¬ ì´ë¥¼ publish í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤. LiDARë¡œ ì˜ˆë¥¼ ë“¤ë©´, ë°˜ê²½ ë‚´ì—ì„œ ê°ì§€í•˜ëŠ” ìˆ˜ë§ì€ point ì¤‘ì—ì„œ, ê°€ì¥ ê°€ê¹Œì´ ìˆëŠ” pointì˜ ê±°ë¦¬ì™€ ê°ë„ë§Œì„ ê±¸ëŸ¬ë‚´, ìë¶ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ê°ë„ë¡œ ë³€í™˜ì„ í•˜ê³ , ì´ë¥¼ í† í”½ìœ¼ë¡œì„œ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì „ë‹¬í•  ìˆ˜ë„ ìˆë‹¤.

# ğŸ‘€ ë©”ì‹œì§€ íƒ€ì… ì¡°íšŒ
ì´ì „ í¬ìŠ¤íŒ…ì—ì„œë„ ë§í¬ë¥¼ ê±¸ì–´ë‘ì–´ ê½¤ ë§ì´ ë³´ì•˜ì„ ê²ƒì´ë‹¤. `std_msgs/Header` ë“± ê¸°ì¡´ì— ë¯¸ë¦¬ ì •ì˜ëœ ë©”ì‹œì§€ íƒ€ì…ë“¤ì´ ìˆë‹¤. ì´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.

êµ¬ê¸€ ê²€ìƒ‰ì°½ì— `ros + [ë©”ì‹œì§€ íƒ€ì…]`ìœ¼ë¡œ ê²€ìƒ‰í•˜ë©´ ê±°ì˜ ëŒ€ë¶€ë¶„ ì²« ì¤„ì— ëœ¬ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `uint16`ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ `ros uint16`ì´ë¼ ê²€ìƒ‰í•œë‹¤.

![](https://images.velog.io/images/717lumos/post/47300631-e676-4801-9659-9d8668ad9eee/20220113_164625.jpg)

ì œì¼ ì²« ì¤„ ROS Documentationì— ë©”ì‹œì§€ íƒ€ì…ì´ ëª…ì‹œë˜ì–´ ìˆë‹¤.

![](https://images.velog.io/images/717lumos/post/070db11c-41dc-4c5b-b582-52f3eed34675/20220113_164721.jpg)

í•´ë‹¹ ë©”ì‹œì§€ê°€ ì–´ë–¤ íŒ¨í‚¤ì§€ì— ì •ì˜ë˜ì–´ ìˆê³ , ì–´ë–¤ íŒŒì¼ì´ê³ , ìƒì„¸í•œ ì •ì˜ê°€ ë‚˜ì™€ìˆë‹¤. ë‹¤ë¥¸ ì˜ˆëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

![](https://images.velog.io/images/717lumos/post/886b4836-78ce-4553-baca-36fa1cd97922/20220113_164857_cr.jpg)
- - -

# ğŸ”¨ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ë§Œë“¤ê¸°

> í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” <span style="color: green">**Pythonì„ ì´ìš©í•´ ì œì‘**</span>í•˜ì˜€ë‹¤. C++ë¡œ ì œì‘í•˜ê³  ì‹¶ë‹¤ë©´ ì•ì„  í¬ìŠ¤íŒ… [[ROS] íŒ¨í‚¤ì§€ ë¹Œë“œì™€ ë…¸ë“œ ì‘ì„±](https://velog.io/@717lumos/ROS-%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%B9%8C%EB%93%9C%EC%99%80-%EB%85%B8%EB%93%9C-%EC%9E%91%EC%84%B1)ì„ ì¶”ê°€ë¡œ ì°¸ê³ í•˜ì—¬ C++ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ê³¼ `CMakeList.txt`, `package.xml` ìˆ˜ì •ì„ í•´ì•¼ í•œë‹¤.

## (0) ìˆœì„œ
ê°„ë‹¨í•˜ê²Œ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ë¥¼ ë§Œë“œëŠ” ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 

1. **êµ¬ìƒí•˜ê¸°**: ë…¸ë“œì™€ í† í”½ì˜ ê´€ê³„, ê° í† í”½ì´ ê°€ì§€ê³  ê°ˆ ë‚´ìš©, ê·¸ë¦¬ê³  ê·¸ ë‚´ìš©ì— ë§ëŠ” ë©”ì‹œì§€ íƒ€ì…ì„ êµ¬ìƒí•œë‹¤. ì¼ì¢…ì˜ ì„¤ê³„ ë‹¨ê³„ì´ë‹¤.
2. **íŒ¨í‚¤ì§€ ë§Œë“¤ê¸°**: ì´ë²ˆ ì‹¤ìŠµì„ ì§„í–‰í•  íŒ¨í‚¤ì§€ë¥¼ ë§Œë“ ë‹¤.
3. **`msg` íŒŒì¼ ë§Œë“¤ê¸°**: ê° í† í”½ì´ ì‚¬ìš©í•  ì»¤ìŠ¤í…€ ë©”ì‹œì§€ íŒŒì¼ì„ ë§Œë“ ë‹¤.
4. **ì†ŒìŠ¤ì½”ë“œ ë§Œë“¤ê¸°**: ê° ë…¸ë“œê°€ í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ ë§Œë“ ë‹¤.
5. **`package.xml`, `CMakeList.txt` íŒŒì¼ ìˆ˜ì •í•˜ê¸°**: í•´ë‹¹ `.msg` íŒŒì¼ì„ ì˜ í¬í•¨í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤.
6. **ì‹¤í–‰í•˜ê¸°**

## (1) êµ¬ìƒí•˜ê¸°

![](https://images.velog.io/images/717lumos/post/10bed764-f100-40c6-846b-e9d554bed57a/%EA%B7%B8%EB%A6%BC6.png)

<span style="color: green">**ì–´ë–¤ ìˆ˜ì˜ ì œê³±ê³¼ ì œê³±ê·¼ì„ ê³„ì‚°í•œ ê²°ê³¼**</span>ë¥¼ ì¶œë ¥í•´ë³¼ ê²ƒì´ë‹¤. <span style="color: green">**ì´ 3ê°œì˜ ë…¸ë“œì™€ ê·¸ ì‚¬ì´ë¥¼ ì˜¤ê°ˆ 2ê°œì˜ í† í”½**</span>ì„ ë§Œë“¤ ê²ƒì´ë‹¤.

`start_node`ì—ì„œ ì‹œì‘í•œ ì‹œê°ê³¼ ë©”ì‹œì§€ ë²ˆí˜¸(1, 2, 3, ...), ê·¸ë¦¬ê³  ê³„ì‚°í•  ìˆ˜ë¥¼ ê²°ì •í•œë‹¤. ê³„ì‚°í•  ìˆ˜ëŠ” 1~100 ì‚¬ì´ì˜ ìˆ˜ë¡œ, ëœë¤í•˜ê²Œ ì„ íƒí•œë‹¤.
`middle_node`ì—ì„œëŠ” ì œê³±ê³¼ ì œê³±ê·¼ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ê³  ì´ ê²°ê³¼ë¥¼ ë§ë¶™ì—¬ ë‹¤ìŒ ë…¸ë“œë¡œ ë³´ë‚¸ë‹¤.
`end_node`ì—ì„œëŠ” ìˆ˜í–‰ì´ ëë‚œ ì‹œê°(`middle_node`ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ì€ ì‹œê°)ì„ ì‹œì‘ ì‹œê°ì—ì„œ ë¹¼ë‚´ ìˆ˜í–‰ ì‹œê°„(nsec ë‹¨ìœ„)ë¥¼ ê³„ì‚°í•˜ê³ , ì œê³±ê³¼ ì œê³±ê·¼ ê³„ì‚° ê²°ê³¼ë¥¼ ì¶œë ¥í•  ê²ƒì´ë‹¤.

## (2) íŒ¨í‚¤ì§€ ë§Œë“¤ê¸°

ë³¸ê²©ì ì¸ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ë§Œë“¤ê¸°ì— ì•ì„œ, ì´ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì. íŒ¨í‚¤ì§€ ì œì‘ì˜ ìƒì„¸í•œ ë‚´ìš©ì€ ì´ì „ í¬ìŠ¤íŒ… [[ROS] íŒ¨í‚¤ì§€ ë¹Œë“œì™€ ë…¸ë“œ ì‘ì„±](https://velog.io/@717lumos/ROS-%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%B9%8C%EB%93%9C%EC%99%80-%EB%85%B8%EB%93%9C-%EC%9E%91%EC%84%B1)ì— ìˆìœ¼ë¯€ë¡œ ì°¸ê³ í•˜ê³ , ì´ë²ˆì—ëŠ” ì ˆì°¨ë§Œ ì†Œê°œí•˜ê² ë‹¤.

`catkin_ws/src`ì— ì‹¤ìŠµ íŒ¨í‚¤ì§€ë¥¼ ë§Œë“ ë‹¤. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ë¡œëŠ” ì¼ë‹¨ pythonê³¼ cpp ë‘˜ ë‹¤ ë„£ì—ˆë‹¤.

```bash
$ cd /catkin_ws/src
$ catkin_create_pkg custom_msg_pkg std_msgs rospy roscpp
```

![](https://images.velog.io/images/717lumos/post/b9fffc76-3830-4ac0-a892-740294bb74e8/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2014-40-17_cr.png)

## (3) msg íŒŒì¼ ë§Œë“¤ê¸°

ìœ„ì—ì„œ êµ¬ìƒí•œ ëŒ€ë¡œ, `first_msg.msg`, `second_msg.msg` íŒŒì¼ì„ ë§Œë“¤ì–´ ë³´ì.

<span style="background-color: #12B886; color: white">**[1]**</span> <span style="color: green">**íŒ¨í‚¤ì§€ í´ë” ì•ˆì— `msg` í´ë”ë¥¼ ë§Œë“ ë‹¤.**</span> `cd /catkin_ws/src/custom_msg_pkg` í•˜ì—¬ íŒ¨í‚¤ì§€ í´ë”ë¡œ ì´ë™í•œ ë’¤ `mkdir msg`ë¥¼ í•´ë„ ë˜ê³ , GUI ìƒì—ì„œ [ìš°í´ë¦­-ìƒˆí´ë”]ë¡œ ê°„ë‹¨íˆ ë§Œë“¤ì–´ë„ ëœë‹¤.

<span style="background-color: #12B886; color: white">**[2]**</span> <span style="color: green">**í•´ë‹¹ ìœ„ì¹˜ì— ë‘ ê°œì˜ ë©”ì‹œì§€ íŒŒì¼ì„ ë§Œë“ ë‹¤. í™•ì¥ìë¥¼ ë°˜ë“œì‹œ `msg`ë¡œ í•´ì•¼ í•¨ì— ì£¼ì˜í•˜ì.**</span>
í•„ìëŠ” Windowsì˜ ë©”ëª¨ì¥ ê¸°ëŠ¥ì„ í•˜ëŠ” ìš°ë¶„íˆ¬ì˜ 'í…ìŠ¤íŠ¸ í¸ì§‘ê¸°'ë¥¼ ì‚¬ìš©í–ˆë‹¤. VS Codeë¡œ ì‘ì„±í•´ë„ ë˜ê³ , ë‹¤ë¥¸ ì—ë””í„° ì–´ë””ë“  ê°€ëŠ¥í•˜ë‹¤.

`first_msg.msg`ì˜ ë‚´ìš©: time í˜•, ì •ìˆ˜í˜• ë°ì´í„°ë¥¼ ì‚¬ìš©í–ˆë‹¤.
```
time start_time
uint16 msg_seq
uint16 original_num
```

`second_msg.msg`ì˜ ë‚´ìš©: float í˜• ë°ì´í„°ë¥¼ ì¶”ê°€ë¡œ ì‚¬ìš©í–ˆë‹¤.
```
time start_time
uint16 msg_seq
uint16 original_num
float32 square_num
float32 sqrt_num
```

## (4) ì†ŒìŠ¤ì½”ë“œ ë§Œë“¤ê¸°

<span style="color: green">**ì´ 3ê°œì˜ ë…¸ë“œê°€ í•„ìš”í•˜ë¯€ë¡œ 3ê°œì˜ ì†ŒìŠ¤ì½”ë“œ(ìŠ¤í¬ë¦½íŠ¸)ê°€ í•„ìš”í•˜ë‹¤.**</span> ì£¼ì˜ì ì€ ì•„ë˜ì™€ ê°™ë‹¤.

* ROS í‘œì¤€ ë©”ì‹œì§€ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, <span style="color: green">**ë©”ì‹œì§€ ë° ìë£Œí˜•ì˜ import êµ¬ë¬¸ì„ í•„íˆ ì‘ì„±**</span>í•´ì•¼ í•œë‹¤.
* <span style="color: green">**msg íŒŒì¼ì—ì„œ ë§Œë“  ìë£Œí˜•ê³¼ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©**</span>í•´ì•¼ í•œë‹¤.

**`start_node_script.py`**
```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-

import rospy		# ROS ë¼ì´ë¸ŒëŸ¬ë¦¬
import random		# ëœë¤ ìˆ˜ë¥¼ ì¶”ì¶œí•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
from custom_msg_pkg.msg import first_msg	# first_msg.msg íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°

def main():
    # í¼ë¸”ë¦¬ì‹œ ë…¸ë“œ ì´ˆê¸°í™”
    rospy.init_node('start_node', anonymous=False)
    
    # í¼ë¸”ë¦¬ì…” ë³€ìˆ˜
    pub = rospy.Publisher('first_topic', first_msg, queue_size=10)
    
    # 1ì´ˆë§ˆë‹¤ ë°˜ë³µ(ë³€ìˆ˜=rate)
    rate = rospy.Rate(1) #1Hz

    msg = first_msg()	# ë©”ì‹œì§€ ë³€ìˆ˜ ì„ ì–¸
    count = 1

    # ì¤‘ë‹¨ë˜ê±°ë‚˜ ì‚¬ìš©ìê°€ ê°•ì œì¢…ë£Œ(ctrl+C) ì „ê¹Œì§€ ê³„ì† ì‹¤í–‰
    while not rospy.is_shutdown():
        # ë©”ì‹œì§€ ë‚´ìš© ë‹´ê¸°
        ## start_time: ë©”ì‹œì§€ë¥¼ ìƒì„±í•´ publish í•˜ëŠ” ì‹œê°
        ## msg_seq: ë©”ì‹œì§€ ìˆœì„œ(ë²ˆí˜¸)
        ## original_num: ê³„ì‚°ì˜ ëŒ€ìƒì´ ë  ìˆ˜ë¡œ, 1ë¶€í„° 100ê¹Œì§€ì˜ ìˆ˜ ì¤‘ ë¬´ì‘ìœ„ë¡œ í•˜ë‚˜ë¥¼ ë½‘ìŒ
        msg.start_time = rospy.Time.now()
        msg.msg_seq = count
        msg.original_num = random.randrange(1,101)

        # í„°ë¯¸ë„ì— ì¶œë ¥
        rospy.loginfo("------")
        rospy.loginfo("Start Time(sec): %d", msg.start_time.secs)
        rospy.loginfo("Message Sequence: %d", msg.msg_seq)
        rospy.loginfo("Original Number: %d", msg.original_num)
                
        # ë©”ì‹œì§€ë¥¼ í¼ë¸”ë¦¬ì‹œ
        pub.publish(msg)
        
        # ì •í•´ë‘” ì£¼ê¸°(hz)ë§Œí¼ ì¼ì‹œì¤‘ë‹¨
        rate.sleep()

        count += 1

if __name__ == '__main__':
    try:
        main()
    except rospy.ROSInterruptException:
        pass
```

> `middle_node.py` ìŠ¤í¬ë¦½íŠ¸ì—ëŠ” <span style="color: green">**í´ë˜ìŠ¤ì˜ ê°œë…**</span>ì´ ë“¤ì–´ê°€ ìˆë‹¤. ì´ì „ í¬ìŠ¤íŒ…ì—ëŠ” ì—†ë˜ ë‚´ìš©ì´ë‚˜, ì‚¬ì‹¤ íŒŒì´ì¬ì˜ í´ë˜ìŠ¤ ê°œë…ì„ ì•ˆë‹¤ë©´ ì•ì„  ìŠ¤í¬ë¦½íŠ¸ë“¤ê³¼ ë³„ë‹¤ë¥¼ ê²ƒì€ ì—†ë‹¤.
ë³¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œ í•¨ìˆ˜(callback í•¨ìˆ˜)ë¥¼ í´ë˜ìŠ¤ì˜ í•¨ìˆ˜ë¡œ ë‘ê³ , í¼ë¸”ë¦¬ì‹œ ê¸°ëŠ¥ì„ í•¨ìˆ˜í™”í–ˆë‹¤ëŠ” ì°¨ì´ ì •ë„ê°€ ìˆë‹¤.

**`middle_node_script.py`**
```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-

import rospy				# ROS ë¼ì´ë¸ŒëŸ¬ë¦¬
import random               # ëœë¤ ìˆ˜ë¥¼ ì¶”ì¶œí•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import math
from custom_msg_pkg.msg import first_msg, second_msg
    # ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œí•˜ëŠ” first_msg.msg íŒŒì¼ê³¼, í¼ë¸”ë¦¬ì‹œí•˜ëŠ” second_msg.msg íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°


class Calc:
    def __init__(self):
        rospy.Subscriber("/first_topic", first_msg, self.first_topic_callback)
        self.pub = rospy.Publisher("/second_topic", second_msg, queue_size=10)

        self.start_time = rospy.Time.now()
        self.msg_seq = 0
        self.original_num = 0
        self.square_num = 0
        self.sqrt_num = 0
        
    # í¼ë¸”ë¦¬ì…” ë…¸ë“œë¡œë¶€í„° í† í”½ì„ ë°›ì•„ë“¤ì´ëŠ” ì½œë°± í•¨ìˆ˜
    def first_topic_callback(self, data):
        self.start_time = data.start_time
        self.msg_seq = data.msg_seq
        self.original_num = data.original_num
        self.square_num = math.pow(self.original_num, 2)
        self.sqrt_num = math.sqrt(self.original_num)

        # ë°›ì€ ë‚´ìš©(data)ë¥¼ í„°ë¯¸ë„ì— ì¶œë ¥
        rospy.loginfo("------")
        rospy.loginfo("Message Sequence: %d", self.msg_seq)
        rospy.loginfo("Original Number: %d", self.original_num)
        rospy.loginfo("Square Number: %d", self.square_num)
        rospy.loginfo("Square Root Number: %d", self.sqrt_num)

    def second_msg_publish(self):
        msg = second_msg()	# ë©”ì‹œì§€ ë³€ìˆ˜ ì„ ì–¸

        # ë©”ì‹œì§€ ë‚´ìš© ë‹´ê¸°
        ## start_time: start_nodeê°€ ë©”ì‹œì§€ë¥¼ ìƒì„±í•´ publish í•˜ëŠ” ì‹œê°
        ## msg_seq: ë©”ì‹œì§€ ìˆœì„œ(ë²ˆí˜¸)
        ## original_num: ê³„ì‚°ì˜ ëŒ€ìƒì´ ë  ìˆ˜
        ## square_num: original_numì˜ ì œê³±
        ## sqrt_num: original_numì˜ ì œê³±ê·¼
        msg.start_time = self.start_time
        msg.msg_seq = self.msg_seq
        msg.original_num = self.original_num
        msg.square_num = self.square_num
        msg.sqrt_num = self.sqrt_num

        self.pub.publish(msg)
    
def main():
    # ë…¸ë“œ ì´ˆê¸°í™”.
    rospy.init_node('middle_node', anonymous=False)
    rate = rospy.Rate(1)

    calc = Calc()
    while not rospy.is_shutdown():
        calc.second_msg_publish()
        rate.sleep()

if __name__ == '__main__':
    try:
        main()
    except rospy.ROSInterruptException:
        pass
```

**`end_node_script.py`**
```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-

import rospy				# ROS ë¼ì´ë¸ŒëŸ¬ë¦¬
from custom_msg_pkg.msg import second_msg    # ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œí•˜ëŠ” second_msg.msg íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°


# í¼ë¸”ë¦¬ì…” ë…¸ë“œë¡œë¶€í„° í† í”½ì„ ë°›ì•„ë“¤ì´ëŠ” ì½œë°± í•¨ìˆ˜
def second_topic_callback(data):
    # ë°›ì€ ë‚´ìš©(data)ë¥¼ í„°ë¯¸ë„ì— ì¶œë ¥
    rospy.loginfo("------")
    rospy.loginfo("Processing Time(nsec): %d", rospy.Time.now().nsecs - data.start_time.nsecs)
    rospy.loginfo("Message Sequence: %d", data.msg_seq)
    rospy.loginfo("Original | Square | Square Root: %d | %d | %d", data.original_num, data.square_num, data.sqrt_num)
    
def main():
    rospy.init_node('end_node', anonymous=False)
    rospy.Subscriber("second_topic", second_msg, second_topic_callback)

    rospy.spin()

if __name__ == '__main__':
    main()
```

## (5) `package.xml`, `CMakeList.txt` íŒŒì¼ ìˆ˜ì •í•˜ê¸°
ë©”ì‹œì§€ íŒŒì¼ì´ë¼ëŠ” ìƒˆ ìš”ì†Œê°€ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ ì‹¤í–‰ ì „ ë¹Œë“œí•˜ê¸° ìœ„í•´ ì‚¬ì „ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤. ë‹¤ì‹œ ì–¸ê¸‰í•˜ì§€ë§Œ, Python ê¸°ì¤€ì´ë¯€ë¡œ C++ë¡œ ì œì‘í–ˆë‹¤ë©´ ìœ„ì—ì„œ ë§í¬í•´ë‘” í¬ìŠ¤íŒ…ì„ ì¶”ê°€ë¡œ ì°¸ê³ í•˜ì—¬ ìˆ˜ì •í•˜ê¸¸ ë°”ë€ë‹¤.

<span style="background-color: #12B886; color: white">**[1]**</span> `package.xml`ì— ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤. ì´ë¯¸ ì¡´ì¬í•˜ê³  ìˆëŠ” íƒœê·¸ë“¤ì˜ ìˆœì„œ(`<build_depend>`ë¼ë¦¬, `<exec_depend>`ë¼ë¦¬)ì— ë§ê²Œ ë„£ëŠ” ê²ƒì´ ì¢‹ë‹¤.
```html
<build_depend>message_generation</build_depend>

<exec_depend>message_runtime</exec_depend>
```

<span style="background-color: #12B886; color: white">**[2]**</span> `CMakeList.txt`ì˜ ì•„ë˜ ë‚´ìš©ì„ ìˆ˜ì •í•œë‹¤. 
```cs
# message_generationì„ ì¶”ê°€í•œë‹¤.
find_package(catkin REQUIRED COMPONENTS
  roscpp
  rospy
  std_msgs
  message_generation
)

# add_message_filesì˜ ì£¼ì„ì„ í’€ê³  ìˆ˜ì •í•œë‹¤.
add_message_files(
  FILES
  Locations.msg
  Coordinate.msg
)

# generate_messagesì˜ ì£¼ì„ì„ í‘¼ë‹¤.
generate_messages(
  DEPENDENCIES
  std_msgs
)

# LIBRARIES, CATKIN_DEPENDSì˜ ì£¼ì„ì„ í’€ê³ , message_runtimeì„ ì¶”ê°€í•œë‹¤.
catkin_package(
#  INCLUDE_DIRS include
  LIBRARIES custom_msg_pkg
  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime
#  DEPENDS system_lib
)

# ì£¼ì„ì„ í’€ê³  ìŠ¤í¬ë¦½íŠ¸ ì´ë¦„ì„ ì…ë ¥í•œë‹¤.
catkin_install_python(PROGRAMS
  src/start_node_script.py
  src/middle_node_script.py
  src/end_node_script.py
  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
```

<span style="background-color: #12B886; color: white">**[3]**</span> ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤.
```bash
$ chmod +x start_node_script.py middle_node_script.py end_node_script.py
```

![](https://images.velog.io/images/717lumos/post/b330c6db-77e3-41a4-b140-f6e27170587f/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2015-31-30_cr.png)

<span style="background-color: #12B886; color: white">**[4]**</span> ë¹Œë“œë¥¼ ì§„í–‰í•œë‹¤.
```bash
$ catkin_make (ë˜ëŠ” cm)
```
## (6) ì‹¤í–‰í•˜ê¸°

ì´ì œ ì‹¤í–‰í•´ë³´ì. ë„¤ ê°œì˜ í„°ë¯¸ë„ ì°½ì´ ì¼ë‹¨ í•„ìš”í•˜ë©°, ê°ê°ì˜ ì°½ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰ì„ ì‹œì¼œë³´ì. ìŠ¤í¬ë¦½íŠ¸ì˜ ê²½ìš° ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œí•˜ëŠ” íŒŒì¼ì„ ë¨¼ì € ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìœ¼ë¯€ë¡œ, end - middle - start ìˆœìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¨ë‹¤.

```bash
$ roscore

$ rosrun custom_msg_pkg end_node_script.py

$ rosrun custom_msg_pkg middle_node_script.py

$ rosrun custom_msg_pkg start_node_script.py
```
![](https://images.velog.io/images/717lumos/post/eabec613-3351-4e8a-9ad1-012cab2359f0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2016-23-35_cr.png)

![](https://images.velog.io/images/717lumos/post/da65e35b-a444-4b02-a004-88dbd59318e1/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2016-24-08_cr.png)

![](https://images.velog.io/images/717lumos/post/2cc59583-f5f6-4e9a-8601-3c550da12572/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2016-23-17_cr.png)

ë§ˆì§€ë§‰ ì‚¬ì§„ì„ ë³´ë©´ ê°’ë“¤ì´ ì˜ ì£¼ê³ ë°›ì•„ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

í•˜ë‚˜ì˜ í„°ë¯¸ë„ì„ ë” ì—´ì–´ <span style='color:green'>**rqtê·¸ë˜í”„ë¥¼ í†µí•´ ë…¸ë“œì™€ í† í”½ ê´€ê³„ë¥¼ ì‹œê°í™”í•´ë³´ì.**</span>
```
$ rqt_graph
```
![](https://images.velog.io/images/717lumos/post/cfaddc41-e02d-4136-857f-9be104158371/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-13%2016-23-43_cr.png)

- - -

# ì°¸ê³  ë¬¸í—Œ
* ["Defining Custom Messages," ROS Wiki](http://wiki.ros.org/ko/ROS/Tutorials/DefiningCustomMessages)