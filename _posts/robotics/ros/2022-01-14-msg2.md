---
title:  "[Tutorial] ì»¤ìŠ¤í…€ ë©”ì‹œì§€(custom msg) ë§Œë“¤ê¸° (2)"
excerpt: "ROS Tutorial 7: ì§ì ‘ ë©”ì‹œì§€í˜•(ROS msg file) ë§Œë“¤ê¸° (2)"

categories:
  - Robotics
  - ROS
tags:
  - Robotics
  - ROS
date: 2022-01-14
last_modified_at: 2022-01-14
order: 7


---

ì§€ë‚œ 1í¸ í¬ìŠ¤íŒ… [[Tutorial] ì»¤ìŠ¤í…€ ë©”ì‹œì§€(custom msg) ë§Œë“¤ê¸° (2)]ì— ì´ì–´ ì˜¤ëŠ˜ì€ 2í¸ìœ¼ë¡œ <span style="color: green">**'ë°°ì—´(ë¦¬ìŠ¤íŠ¸) ìë£Œí˜•ì„ í¬í•¨í•œ' ì»¤ìŠ¤í…€ ë©”ì‹œì§€**</span>ë¥¼ ë§Œë“¤ì–´ë³¼ ê²ƒì´ë‹¤.

# ğŸ’¬ ë°°ì—´ì„ í¬í•¨í•œ ë©”ì‹œì§€
ê°€ë” í‘œì¤€ ë©”ì‹œì§€í˜•ì„ ë³´ë‹¤ê°€ ìë£Œí˜• ë’¤ì— `[]`ì´ ë¶™ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ê·¸ê²ƒì´ ë°°ì—´í˜•ì´ë¼ëŠ” ì˜ë¯¸ì´ë‹¤. `float32[]`ë¼ë©´ float32í˜•ì˜ ìˆ«ì ì—¬ëŸ¬ ê°œê°€ ë°°ì—´ë¡œ ì „ë‹¬ëœë‹¤ëŠ” ëœ»ì´ë‹¤.

![](https://images.velog.io/images/717lumos/post/03c1c33c-0acc-4d25-9508-f54a698aaed7/20220113_164857_cr.jpg)

ì—¬ëŸ¬ ë²ˆ ì†Œê°œí–ˆì§€ë§Œ, IMUì—ì„œ í¼ë¸”ë¦¬ì‹œí•˜ëŠ” ë©”ì‹œì§€ ì¤‘ í•˜ë‚˜ì¸ `sensor_msgs/Imu`ë¥¼ ì‚´í´ë³´ë©´, <span style="color: green">**`float64[9]`ë¼ê³  ë˜ì–´ ìˆë‹¤. float64, ì¦‰ ì‹¤ìˆ˜ í˜• ìˆ«ì 9ê°œë¡œ ì´ë£¨ì–´ì§„ ë°ì´í„°**</span>ë€ ëœ»ì´ë‹¤. ì‹¤ì œë¡œ ì´ ìë£Œí˜•ì„ ì“°ê³  ìˆëŠ” ë°ì´í„°ë“¤ì€ x, y, z ì¶•ì— ëŒ€í•œ ê³µë¶„ì‚°ì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤.

![](https://images.velog.io/images/717lumos/post/088988a3-d7d9-46e4-89b9-aca3f90e7bb9/20220114_075916.jpg)

ë˜ ë‹¤ë¥¸ ì˜ˆë¥¼ ë³´ì. ì—¬ê¸°ì„œëŠ” <span style="color: green">**ë°°ì—´ì˜ í¬ê¸°ê°€ ì§€ì •ë˜ì§€ ì•Šê³  ê·¸ì € `[]`ë¼ê³ ë§Œ ë˜ì–´ ìˆë‹¤.**</span> ë°°ì—´ì˜ í¬ê¸°ê°€ ë§¤ë²ˆ ë°”ë€ŒëŠ” ê²½ìš° ì´ë ‡ê²Œ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤.

- - -

# ğŸ’Œ ë°°ì—´ì„ í¬í•¨í•œ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ë§Œë“¤ê¸°
## (0) ìˆœì„œ

ìˆœì„œëŠ” ì•ì„  í¬ìŠ¤íŒ…ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìì„¸í•œ ì„¤ëª…ì€ ìƒëµí•˜ê³  ì ˆì°¨ë§Œ ë‚˜íƒ€ë‚´ê² ë‹¤.

1. **êµ¬ìƒí•˜ê¸°**
2. **íŒ¨í‚¤ì§€ ë§Œë“¤ê¸°**
3. **`msg` íŒŒì¼ ë§Œë“¤ê¸°**
4. **ì†ŒìŠ¤ì½”ë“œ ë§Œë“¤ê¸°**
5. **`package.xml`, `CMakeList.txt` íŒŒì¼ ìˆ˜ì •í•˜ê¸°**
6. **ì‹¤í–‰í•˜ê¸°**

## (1) êµ¬ìƒí•˜ê¸°

![](https://images.velog.io/images/717lumos/post/79f516b4-c9f5-42c2-87e7-b996b5311110/%EA%B7%B8%EB%A6%BC1.png)

<span style="color: green">**ë©”ì‹œì§€ì˜ ë²ˆí˜¸ì™€ (x, y) ì¢Œí‘œ ì—¬ëŸ¬ ê°œì˜ ì •ë³´ë¥¼ í•œ í† í”½ì— ë‹´ì•„ ì „ì†¡**</span>í•´ë³´ì. 

ë‹¨ìˆœíˆ `data_node`ì—ì„œëŠ” ê°’ì„ í¼ë¸”ë¦¬ì‹œí•˜ê³  `print_node`ì—ì„œëŠ” ê°’ì„ ë°›ì•„ í„°ë¯¸ë„ì— ì¶œë ¥í•˜ê¸°ë§Œ í•  ê²ƒì´ë‹¤. í¼ë¸”ë¦¬ì‹œ/ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œ ë˜ëŠ” í† í”½ì˜ ì´ë¦„ì€ `poins`ì´ë‹¤.

ë©”ì‹œì§€ë¥¼ ë³´ë©´, <span style="color: green">**í† í”½ `points`ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìë£Œí˜• `Locations`ì—ì„œëŠ” (x, y) ì¢Œí‘œì¸ `location`ì„ `Coordinate`ë¼ëŠ” ìë£Œí˜•ì˜ ë°°ì—´ë¡œ í•˜ê³  ìˆë‹¤**</span>. ë©”ì‹œì§€í˜• `Coordinate`ëŠ” ê°ê° ì‹¤ìˆ˜í˜•ì˜ x, y ê°’ì„ ê°€ì§€ê³  ìˆë‹¤. ì§ê´€ì ìœ¼ë¡œ ì´í•´í•˜ìë©´ [x, y]ë¼ê³  í‘œì‹œí–ˆì„ ë•Œ, `location` = `[[1, 2], [3, 4], [6, 7], [7, 8],...]`ê°€ ëœë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

## (2) íŒ¨í‚¤ì§€ ë§Œë“¤ê¸°
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œë„ <span style="color: green">**íŒŒì´ì¬ì„ ê¸°ì¤€ìœ¼ë¡œ**</span> ì„¤ëª…í•  ì˜ˆì •ì´ë‹¤. C++ë¡œ ë§Œë“¤ ê²½ìš° [[ROS] íŒ¨í‚¤ì§€ ë¹Œë“œì™€ ë…¸ë“œ ì‘ì„±](https://winterbloooom.github.io/robotics/ros/2021/10/07/package_node.html) ì„ ì°¸ê³ í•˜ì.

`/catkin_ws/src`ë¡œ ì´ë™í•´ íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•œë‹¤.
```bash
$ cd /catkin_ws/src
$ catkin_create_pkg custom_msg2_pkg std_msgs rospy
```

![](https://images.velog.io/images/717lumos/post/12e91f8d-e7c7-44a0-a433-d9c6ad327970/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2008-45-03_cr.png)

## (3) msg íŒŒì¼ ë§Œë“¤ê¸°

<span style="color: green">**íŒ¨í‚¤ì§€ ë””ë ‰í† ë¦¬ ë‚´ì— `msg` ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³ **</span> ê·¸ ì•ˆì— ë‘ ê°œì˜ ë©”ì‹œì§€ íŒŒì¼ `Locations.msg`, `Coordinate.msg`ë¥¼ ë§Œë“ ë‹¤.

![](https://images.velog.io/images/717lumos/post/256d674f-23cd-44d5-a2a3-eae3170f934c/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2008-45-16_cr.png)

**`Locations.msg`**
```
uint16 msg_seq
Coordinate[] location
```

**`Coordinate.msg`**
```
int16 x
int16 y
```

## (4) ì†ŒìŠ¤ì½”ë“œ ë§Œë“¤ê¸°
ë‘ ê°œì˜ ë…¸ë“œì— ëŒ€í•´ ê°ê° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“ ë‹¤.

**`data_node_script.py`**
```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-

from __future__ import print_function	#printí•¨ìˆ˜ì˜ end ì˜µì…˜ ì‚¬ìš© ìœ„í•¨
import rospy
import random
from custom_msg2_pkg.msg import Locations, Coordinate

def main():
    rospy.init_node('data_node', anonymous=False)

    pub = rospy.Publisher('points', Locations, queue_size=10)

    rate = rospy.Rate(1)

    count = 1

    while not rospy.is_shutdown():
        loc = Locations()
        loc.msg_seq = count	# ë©”ì‹œì§€ ë²ˆí˜¸

        loc_size = random.randrange(1,5)	# ì¢Œí‘œ ê°œìˆ˜ë¥¼ ëœë¤ìœ¼ë¡œ 1~4ê°œ ì¤‘ íƒ

        for i in range(loc_size):
            x_value = random.randrange(-50,51)	# xì¢Œí‘œ
            y_value = random.randrange(-50,51)	# yì¢Œí‘œ
            loc.location.append(Coordinate(x=x_value, y=y_value))
            	# Coordinate í˜•ìœ¼ë¡œ ë°°ì—´ì— ì¶”ê°€í•¨

        # ì „ì†¡í•  í† í”½ì„ ì¶œë ¥í•´ë³¸ë‹¤.
        print("-"*10)
        print("Message Sequence:", loc.msg_seq)
        print("Locations:")
        for i in range(loc_size):
            print("(", loc.location[i].x, ", ", loc.location[i].y, ")", end=', ')
        print("\n")
        
        pub.publish(loc)
        
        rate.sleep()

        count += 1

if __name__ == '__main__':
    try:
        main()
    except rospy.ROSInterruptException:
        pass
```

**`print_node_script.py`**
```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-

from __future__ import print_function
import rospy				
from custom_msg2_pkg.msg import Locations, Coordinate


def points_topic_callback(data):
    loc_size = len(data.location)
    print("-"*10)
    print("Message Sequence:", data.msg_seq)
    print("Locations:")
    for i in range(loc_size):
        print("(", data.location[i].x, ", ", data.location[i].y, ")", end=', ')
    print("\n")
    
def main():
    rospy.init_node('print_node', anonymous=False)
    rospy.Subscriber("points", Locations, points_topic_callback)

    rospy.spin()

if __name__ == '__main__':
    main()
```

## (5) `package.xml`, `CMakeList.txt` íŒŒì¼ ìˆ˜ì •í•˜ê¸°

<span style="background-color: #12B886; color: white">**[1]**</span> `package.xml`ì— ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤.
```html
<build_depend>message_generation</build_depend>

<exec_depend>message_runtime</exec_depend>
```

<span style="background-color: #12B886; color: white">**[2]**</span> `CMakeList.txt`ì— ì•„ë˜ ë‚´ìš©ì„ ìˆ˜ì •í•œë‹¤.
```cs
# message_generationì„ ì¶”ê°€í•œë‹¤.
find_package(catkin REQUIRED COMPONENTS
  rospy
  std_msgs
  message_generation
)

# add_message_filesì˜ ì£¼ì„ì„ í’€ê³  ìˆ˜ì •í•œë‹¤.
add_message_files(
  FILES
  Locations.msg
  Coordinate.msg
)

# generate_messagesì˜ ì£¼ì„ì„ í‘¼ë‹¤.
generate_messages(
  DEPENDENCIES
  std_msgs
)

# LIBRARIES, CATKIN_DEPENDSì˜ ì£¼ì„ì„ í’€ê³ , message_runtimeì„ ì¶”ê°€í•œë‹¤.
catkin_package(
#  INCLUDE_DIRS include
  LIBRARIES custom_msg2_pkg
  CATKIN_DEPENDS rospy std_msgs message_runtime
#  DEPENDS system_lib
)

# ì£¼ì„ì„ í’€ê³  ìŠ¤í¬ë¦½íŠ¸ ì´ë¦„ì„ ì…ë ¥í•œë‹¤.
catkin_install_python(PROGRAMS
  src/data_node_script.py
  src/print_node_script.py
  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
)
```

<span style="background-color: #12B886; color: white">**[3]**</span> ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤.
```bash
$ chmod +x data_node_script.py print_node_script.py
```

<span style="background-color: #12B886; color: white">**[4]**</span> ë¹Œë“œë¥¼ ì§„í–‰í•œë‹¤.
```bash
$ catkin_make (ë˜ëŠ” cm)
```

## (6) ì‹¤í–‰í•˜ê¸°
`roscore`ë¥¼ ì¼¤ ì°½, `data_node_script.py`ë¥¼ ì¼¤ ì°½, `print_node_script.py`ë¥¼ ì¼¤ ì°½, ì´ë ‡ê²Œ ì´ 3ê°œì˜ í„°ë¯¸ë„ ì°½ì´ í•„ìš”í•˜ë‹¤. ì„œë¸ŒìŠ¤í¬ë¼ì´ë¸Œ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ë‹¤.

```bash
$ roscore

$ rosrun custom_msg2_pkg data_node_script.py

$ rosrun custom_msg2_pkg print_node_script.py
```

![](https://images.velog.io/images/717lumos/post/3ac8fda3-b4de-4594-9031-4572f3c65029/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2009-21-38_cr.png)

![](https://images.velog.io/images/717lumos/post/6c5ef9cb-acd4-4bae-bfeb-035327f1364d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2009-21-53_cr.png)

rqt ê·¸ë˜í”„ì™€ í† í”½ ë¦¬ìŠ¤íŠ¸, ë©”ì‹œì§€ ë‚´ìš©ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```bash
$ rqt_graph
```

![](https://images.velog.io/images/717lumos/post/ce56ae33-efa3-413d-bc55-ab2f5af110fa/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2009-22-36_cr.png)

```bash
$ rostopic list

$ rostopic echo /points
```
![](https://images.velog.io/images/717lumos/post/312526be-c5a0-4b3e-97dd-25a3d7b2b81f/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7,%202022-01-14%2009-22-21_cr.png)

- - -

# ì°¸ê³  ë¬¸í—Œ
* ["Pythonì—ì„œ ì¤„ ë°”ê¿ˆì—†ì´ ì¸ì‡„," DelftStack](https://www.delftstack.com/ko/howto/python/python-print-without-newline/)
